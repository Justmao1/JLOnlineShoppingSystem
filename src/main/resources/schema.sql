-- Create USERS table
CREATE TABLE USERS (
    USER_ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    USERNAME VARCHAR(50) NOT NULL UNIQUE,
    PASSWORD VARCHAR(50) NOT NULL,
    EMAIL VARCHAR(100),
    PHONE VARCHAR(20),
    ROLE VARCHAR(20) DEFAULT 'CUSTOMER', -- 'CUSTOMER' or 'ADMIN'
    BALANCE DECIMAL(10, 2) DEFAULT 0.00,
    CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create ADDRESSES table
CREATE TABLE ADDRESSES (
    ADDRESS_ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    USER_ID INT,
    FULL_NAME VARCHAR(100),
    ADDRESS_LINE VARCHAR(255),
    CITY VARCHAR(100),
    POSTAL_CODE VARCHAR(20),
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID)
);

-- Create CATEGORIES table
CREATE TABLE CATEGORIES (
    CATEGORY_ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    CATEGORY_NAME VARCHAR(100) NOT NULL UNIQUE
);

-- Create PRODUCTS table
-- Create PRODUCTS table
CREATE TABLE PRODUCTS (
    PRODUCT_ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    NAME VARCHAR(100) NOT NULL,
    DESCRIPTION VARCHAR(255),
    PRICE DECIMAL(10, 2) NOT NULL,
    STOCK_QUANTITY INT,
    CATEGORY VARCHAR(50),
    SALES_VOLUME INT DEFAULT 0,
    IMAGE_PATH VARCHAR(255)
);

-- Create SHOPPING_CART table
CREATE TABLE SHOPPING_CART (
    CART_ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    USER_ID INT,
    PRODUCT_ID INT,
    QUANTITY INT DEFAULT 1,
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID),
    FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID)
);

-- Create ORDERS table
CREATE TABLE ORDERS (
    ORDER_ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    USER_ID INT,
    TOTAL_AMOUNT DECIMAL(10, 2),
    STATUS VARCHAR(20), -- 'PENDING', 'PAID', 'SHIPPED'
    ORDER_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID)
);

-- Create ORDER_ITEMS table
CREATE TABLE ORDER_ITEMS (
    ITEM_ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    ORDER_ID INT,
    PRODUCT_ID INT,
    QUANTITY INT,
    PRICE_AT_PURCHASE DECIMAL(10, 2),
    FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID),
    FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID)
);

-- Create PAYMENTS table
CREATE TABLE PAYMENTS (
    PAYMENT_ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    ORDER_ID INT,
    PAYMENT_METHOD VARCHAR(50),
    AMOUNT DECIMAL(10, 2),
    STATUS VARCHAR(20),
    PAYMENT_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID)
);

-- Create WISHLIST table
CREATE TABLE WISHLIST (
    WISHLIST_ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    USER_ID INT,
    PRODUCT_ID INT,
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID),
    FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID)
);

-- Create PAYMENT_METHODS table
CREATE TABLE PAYMENT_METHODS (
    PAYMENT_METHOD_ID INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
    USER_ID INT,
    CARD_NUMBER VARCHAR(20),
    EXPIRY_DATE VARCHAR(10),
    FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID)
);





-- Seed Data (Synced from Local DB)
INSERT INTO USERS (USER_ID, USERNAME, PASSWORD, EMAIL, PHONE, ROLE, BALANCE, CREATED_DATE) VALUES (1, 'admin', 'admin123', 'admin@store.com', NULL, 'ADMIN', 1000.00, '2025-12-03 13:59:42.598');
INSERT INTO USERS (USER_ID, USERNAME, PASSWORD, EMAIL, PHONE, ROLE, BALANCE, CREATED_DATE) VALUES (2, 'user123', 'user12345', 'user@store.com', NULL, 'CUSTOMER', 1050.00, '2025-12-03 13:59:42.6');


INSERT INTO PRODUCTS (PRODUCT_ID, NAME, DESCRIPTION, PRICE, STOCK_QUANTITY, CATEGORY, SALES_VOLUME, IMAGE_PATH) VALUES (1, 'Java Programming Book', 'Comprehensive guide to Java 21', 59.99, 110, 'Books', 10, 'images/1764838175752_CleanShot 2025-12-04 at 10.34.12@2x.png');
INSERT INTO PRODUCTS (PRODUCT_ID, NAME, DESCRIPTION, PRICE, STOCK_QUANTITY, CATEGORY, SALES_VOLUME, IMAGE_PATH) VALUES (2, 'Mechanical Keyboard', 'Clicky keys for coding', 120.50, 2, 'Electronics', 50, NULL);
INSERT INTO PRODUCTS (PRODUCT_ID, NAME, DESCRIPTION, PRICE, STOCK_QUANTITY, CATEGORY, SALES_VOLUME, IMAGE_PATH) VALUES (3, 'IntelliJ IDEA License', '1-year subscription', 149.00, 984, 'Electronics', 100, 'images/1764814219318_CleanShot 2025-12-04 at 10.09.41@2x.png');
INSERT INTO PRODUCTS (PRODUCT_ID, NAME, DESCRIPTION, PRICE, STOCK_QUANTITY, CATEGORY, SALES_VOLUME, IMAGE_PATH) VALUES (4, 'Design Patterns E-Book', 'PDF version of GoF book', 29.99, 989, 'Books', 20, NULL);
INSERT INTO PRODUCTS (PRODUCT_ID, NAME, DESCRIPTION, PRICE, STOCK_QUANTITY, CATEGORY, SALES_VOLUME, IMAGE_PATH) VALUES (5, 'Running Shoes', 'Comfortable running shoes', 89.99, 50, 'Sports & Outdoors', 5, 'images/1764741696924_phone.png');


INSERT INTO ORDERS (ORDER_ID, USER_ID, TOTAL_AMOUNT, STATUS, ORDER_DATE) VALUES (301, 2, 2077.00, 'PAID', '2025-12-04 10:05:13.486');
INSERT INTO ORDERS (ORDER_ID, USER_ID, TOTAL_AMOUNT, STATUS, ORDER_DATE) VALUES (401, 2, 149.00, 'PAID', '2025-12-04 19:01:29.927');
INSERT INTO ORDERS (ORDER_ID, USER_ID, TOTAL_AMOUNT, STATUS, ORDER_DATE) VALUES (501, 2, 59.99, 'PAID', '2025-12-04 19:08:06.707');


INSERT INTO ORDER_ITEMS (ITEM_ID, ORDER_ID, PRODUCT_ID, QUANTITY, PRICE_AT_PURCHASE) VALUES (301, 301, 3, 5, 149.00);
INSERT INTO ORDER_ITEMS (ITEM_ID, ORDER_ID, PRODUCT_ID, QUANTITY, PRICE_AT_PURCHASE) VALUES (302, 301, 5, 2, 666.00);
INSERT INTO ORDER_ITEMS (ITEM_ID, ORDER_ID, PRODUCT_ID, QUANTITY, PRICE_AT_PURCHASE) VALUES (401, 401, 3, 1, 149.00);
INSERT INTO ORDER_ITEMS (ITEM_ID, ORDER_ID, PRODUCT_ID, QUANTITY, PRICE_AT_PURCHASE) VALUES (501, 501, 1, 1, 59.99);



INSERT INTO PAYMENT_METHODS (PAYMENT_METHOD_ID, USER_ID, CARD_NUMBER, EXPIRY_DATE) VALUES (1, 2, '123321', '22/33');


-- Restart Sequences
ALTER TABLE USERS ALTER COLUMN USER_ID RESTART WITH 4;
ALTER TABLE ADDRESSES ALTER COLUMN ADDRESS_ID RESTART WITH 1;
ALTER TABLE PRODUCTS ALTER COLUMN PRODUCT_ID RESTART WITH 6;
ALTER TABLE SHOPPING_CART ALTER COLUMN CART_ID RESTART WITH 1;
ALTER TABLE ORDERS ALTER COLUMN ORDER_ID RESTART WITH 502;
ALTER TABLE ORDER_ITEMS ALTER COLUMN ITEM_ID RESTART WITH 502;
ALTER TABLE PAYMENTS ALTER COLUMN PAYMENT_ID RESTART WITH 1;
ALTER TABLE WISHLIST ALTER COLUMN WISHLIST_ID RESTART WITH 102;
ALTER TABLE PAYMENT_METHODS ALTER COLUMN PAYMENT_METHOD_ID RESTART WITH 2;
